# Barnes–Hut N-Body

Визуализация гравитационной динамики по алгоритму Барнса–Хатта, реализованная на Kotlin/Swing. Приложение запускается в полноэкранном безрамочном режиме, автоматически подстраиваясь под текущее разрешение дисплея, и демонстрирует столкновение двух кеплеровских дисков, сформированных из центральной массивной звезды и кольца спутников с корректно посчитанной enclosed mass.

## Быстрый старт

1. Установите JDK 18 (подойдёт Temurin или любая совместимая сборка).
2. Выполните сборку через Gradle Wrapper:
   ```bash
   ./gradlew build
   ```
3. Запустите собранный jar c главным классом `MainKt`:
   ```bash
   java -cp build/libs/Gravity2D_Barnes-Hutt_alg-1.0-SNAPSHOT.jar MainKt
   ```
   Также можно импортировать проект в IntelliJ IDEA и запустить `main()` из `Main.kt`.

## Стартовая сцена

* Два симметричных кеплеровских диска (по 4000 тел каждый) движутся навстречу друг другу с противоположным дрейфом по оси X.
* Центральное тело каждого диска имеет массу `50 000`, суммарная масса спутников — `1000`, радиус дисков — `100` пикселей.
* Позиции частиц и их скорости формируются фабрикой `BodyFactory.makeKeplerDisk(...)` с учётом enclosed mass, чтобы орбиты соответствовали канону DAML.

## Алгоритм и особенности реализации

* Пространство разбивается квадродеревом `BHTree`, критерий приближения: `s² < θ² · dist²`, где θ изменяется на лету (`0.2`–`1.6`).
* Расчёт сил выполняется параллельно через `kotlinx.coroutines` на числе потоков, равном количеству доступных ядер CPU.
* Интегрирование — симметричный Leapfrog (kick–drift–kick) с регулируемым шагом `Δt`.
* Применяется софтенинг силы (`ε = 1.0`) для стабилизации близких столкновений.

## Управление

### Мышь
* **ЛКМ + перетаскивание** — создать новый кеплеровский диск в точке нажатия; вектор перетаскивания задаёт добавочную скорость (`1 px = 1 ед/с`).
* **Средняя кнопка** — очистить сцену.

### Клавиатура
* `SPACE` — пауза/продолжить.
* `R` — сброс к стартовой конфигурации двух дисков.
* `ESC` — выход.
* `Z / X` — уменьшить/увеличить θ (Barnes–Hut).
* `A / S` — изменить число тел в добавляемом диске (от 1000 до 10000, шаг 100).
* `Q / W` — изменить радиус создаваемого диска (100–500 px, шаг 10).
* `O / P` — уменьшить/увеличить шаг интегрирования `Δt` (от −0.015 до 0.015).
* `K / L` — уменьшить/увеличить гравитационную постоянную `G` (0–100).
* `D` — Debug mode (on/off).

## HUD и диагностика

В левом верхнем углу выводится строка подсказок по основным сочетаниям, текущие значения `R`, `N`, θ, `Δt`, `G`, а также размер системы (количество частиц). Для отладки отрисовывается пунктир от точки нажатия мыши и окружность радиуса будущего диска.

## Настройка

Дополнительные параметры (размер окна, величина софтенинга, массы и т. п.) сосредоточены в `Config.kt` и могут быть изменены перед сборкой.

